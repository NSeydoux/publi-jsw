\begin{tikzpicture}
	\input{figures/topologies/illustration_edrpt.tikz}
	
	%Caption
	\draw (-4,1) node[right] {\footnotesize $R_{V}$: $R_{Visibility}$};
	\draw (-4,0.5) node[right] {\footnotesize $R_{C}$: $R_{ColdChain}$};
	\draw[dashed, gray] (-4,0) node {} -- (-3.5,0) node {};
	\draw (-3.5,0) node[right] {\footnotesize: Applies rule};
	\draw[->, olive] (-4,-0.5) node {} -- (-3.5,-0.5) node {};
	\draw (-3.5,-0.5) node[right] {\footnotesize: Propagates rule};
	\draw[->, blue] (-4,-1) node {} -- (-3.5,-1) node {};
	\draw (-3.5,-1) node[right] {\footnotesize: Propagates data};
	\draw (-4.1,1.2) -- (-1.4, 1.2) -- (-1.4, -1.3) -- (-4.1,-1.3) -- cycle;


	\node[appNode, right of=d, xshift=2cm] (app) {\pbox{3cm}{\Centering Control\\center}};
	\draw[<-, snake=bent, raise snake=4pt, olive]  (d.north east) -- node[above, text depth=12pt] {\pbox{3cm}{\Centering Registers $R_{V}$, $R_{C}$}} (app.side 2);

	\draw[->, olive] (d.south east) to[out=300,in=30] node [right] {$R_{V}$, $R_{C}$} (f100.north east);
	\draw[->, olive] (f100.west) to[out=180,in=90] node [left] {\pbox{2cm}{\Centering $R_{V}$}} (g110.north);
	\draw[->, olive] (f100.east) to[out=0,in=90] node [yshift=0.2cm, right] {\pbox{2cm}{\Centering $R_{V}, R_{C}$}} (g120.north);
	\draw[->, olive] (g110.south west) to[out=250,in=90] node [left] {\pbox{2cm}{\Centering $R_{V}$}} (r111.north);
%	\draw[->, blue] (r111.north west) to[out=120,in=180] node [left] {\pbox{2cm}{\Centering \scalebox{0.8}{\temperature}}} (g110.west);
	
	\draw[->, olive] (g110.south east) to[out=270,in=100] node [right] {\pbox{2cm}{\Centering $R_{V}$}} (r112.north);
%	\draw[->, blue] (r112.north east) to[out=45,in=0] node [right] {\pbox{2cm}{\Centering \scalebox{0.8}{\temperature}}} (g110.east);
	
	\draw[dashed, gray] ([xshift=-0.3cm, yshift=0.3cm]r111.west) node [above] {$R_{V}$} -- (r111.west);
	\draw[dashed, gray] ([xshift=0.3cm, yshift=0.3cm]r112.east) node [above] {$R_{V}$} -- (r112.east);
	
%	\draw[dashed, gray] ([xshift=-0.3cm, yshift=0.3cm]g110.north west) node [above] {$R_{TG}$} -- (g110.north west);
	\draw[dashed, gray] ([xshift=0.3cm, yshift=0.3cm]g120.north east) node [above] {$R_{V}, R_{C}$} -- (g120.north east);
	
	\draw[->, blue] (r121.north) to[out=90,in=180] node [left] {\pbox{2cm}{\Centering \scalebox{0.8}{\off, \presence}}} (g120.west);
	\draw[->, blue] (r122.north) to[out=90,in=0] node [right] {\pbox{2cm}{\Centering \scalebox{0.8}{\off, \luminosity}}} (g120.east);
	
\end{tikzpicture}
